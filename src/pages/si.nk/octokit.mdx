---
title: octokit
url: si.nk/octokit
layout : "@/layouts/Blog.astro"
---
import C from '@/components/Poly.astro'
import JSONDebug from '@/components/Json.astro'

export const data = 
`https://github.com/violeine/viole.in/blob/main/src/components/count.jsx#L1-L10`

export const getContent = async (link) => {
  const parsedLink = parse(link);
  const [start, end] = parsedLink.hash;
  const content = await fetch(parsedLink.url).then((r) => r.text());
  return content
    .split("\n")
    .splice(start - 1, end + 1)
    .join("\n");
};

export const parse = (link) => {
  const t = new URL(link);
  const [, owner, repo, _, tree, ...route] = t.pathname.toString().split("/");
  const lang = route.at(-1).split(".").at(-1);
  const line = t.hash
    .split(`-`)
    .map((s) => s.split("L"))
    .flat()
    .filter((e) => Number(e));
  return {
    url: `https://raw.githubusercontent.com/${owner}/${repo}/${tree}/${route.join(
      "/"
    )}`,
    hash: line,
    lang: lang,
  };
};

export const parsedData = parse(data)

### share code snippet with github

- first fetch the content with `raw.githubusercontent`

- use `Array.prototype.splice()` to get the range out

```js
	const contentRange = content.split("\n").splice(start-1, end+1)
```

- ended up with this

<C data={data}/>

- parse the link

				example:

						{data}

				schema:

				`https://github.com/${owner}/${repo}/blob/${tree}/${route}`

				raw.githubcontent:

				`https://raw.githubusercontent.com/violeine/viole.in/main/src/pages/po.rt.astro`

				schema: 

				`https://raw.githubusercontent.com/${owner}/${repo}/${route}`

- parse result:
<JSONDebug data={parse(data)}/>
