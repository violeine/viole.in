---
interface Props {
  content: string;
}
import { render } from "@/lib/md";
import { rehype } from "rehype";
import type { Root, Properties } from "hast";
import { visit } from "unist-util-visit";
const { content } = Astro.props;

const htmlString = await render(content);

const rewriteImageUrl = () => {
  return (tree: Root) => {
    visit(tree, "element", function (node) {
      if (node.tagName === "img") {
        if (node.properties) {
          const src = node.properties.src;
          if (typeof src === "string")
            node.properties.src = `http://localhost${src.slice(2)}`;
        }
      }
    });
  };
};

const file = await rehype().use(rewriteImageUrl).process(htmlString);
---

<div set:html={String(file)} />
